<%= render "shared/header" %>

<div class="container">
  <div class="card bg-light my-4" >
    <div class="row " >
      <div class="col">

        <%# インシデント情報 %>
        <div class="card-body">
          <% if @incident.image.attached? %>
            <%= image_tag @incident.image, class:"d-block mx-auto image-show" %>
          <% else %>
            <%= image_tag "no_image.jpeg" , class:"d-block mx-auto image-show" %>
          <% end %>
        </div>
        <div class="card-body mx-2">
          <div class="card-text">
            <small class="text-secondary">Date</small><br>
            <%= @incident.date %>
          </div>
          <div class="card-text">
            <small class="text-secondary">Title</small><br>
            <%= @incident.title %>
          </div>
          <div class="card-text">
            <small class="text-secondary">Content</small><br>
            <%= @incident.content %>
          </div>
          <div class="card-text">
            <small class="text-secondary">Place</small><br>
            <%= @incident.place.name %>
          </div>
          <div class="card-text">
            <small class="text-secondary">Contributor</small><br>
            <%= @incident.user.name %>
          </div>
          <div class="d-grid gap-2 my-2 d-md-flex justify-content-md-end">
            <% if current_user.id == @incident.user_id %>
              <%= link_to '編集', edit_incident_path(@incident), class:"btn btn-secondary", type:"button" %>
              <%= link_to '削除', incident_path(@incident), method: :delete, class:"btn btn-secondary", type:"button" %>
            <% end %>
          </div>
        </div>
      </div>
      <%# /インシデント情報 %>

      <%# レスポンス情報 %>
      <% if @incident.response.nil? %>
        <%# レスポンス未投稿の場合 %>
        <div class="col">
          <div class="card-body">
            <%= image_tag "unsolved.png" , class:"d-block mx-auto image-show" %>
          </div>
          <div class="card-body mx-2">
            <div class="card-text">
              <small class="text-secondary">Date</small><br>
              ---
            </div>
            <div class="card-text">
              <small class="text-secondary">Title</small><br>
              ---
            </div>
            <div class="card-text">
              <small class="text-secondary">Content</small><br>
              ---
            </div>
            <div class="card-text">
              <small class="text-secondary">Cost</small><br>
              ---
            </div>
            <div class="card-text">
              <small class="text-secondary">Contributor</small><br>
              ---
            </div>
            <div class="d-grid gap-2 my-2 d-md-flex justify-content-md-end">
              <%= link_to '投稿', new_incident_response_path(@incident, @response), class:"btn btn-secondary", type:"button" %>
            </div>
          </div>
        </div>
        <%# /レスポンス未投稿の場合 %>
      <% else %>
        <%# レスポンス投稿済みの場合 %>
        <div class="col">
          <div class="card-body">
            <% if @incident.image.attached? %>
              <%= image_tag @incident.response.image, class:"d-block mx-auto image-show" %>
            <% else %>
              <%= image_tag "no_image.jpeg" , class:"d-block mx-auto image-show" %>
            <% end %>
          </div>
          <div class="card-body mx-2">
            <div class="card-text">
              <small class="text-secondary">Date</small><br>
              <%= @incident.response.date %>
            </div>
            <div class="card-text">
              <small class="text-secondary">Title</small><br>
              <%= @incident.response.title %>
            </div>
            <div class="card-text">
              <small class="text-secondary">Content</small><br>
              <%= @incident.response.content %>
            </div>
            <div class="card-text">
              <small class="text-secondary">Cost</small><br>
              <%= @incident.response.cost %>円
            </div>
            <div class="card-text">
              <small class="text-secondary">Contributor</small><br>
              <%= @incident.response.user.name %>
            </div>
            <div class="d-grid gap-2 my-2 d-md-flex justify-content-md-end">
              <% if current_user.id == @incident.response.user_id %>
                <%= link_to '編集', edit_incident_response_path(@incident, @incident.response), class:"btn btn-secondary", type:"button" %>
                <%= link_to '削除', incident_response_path(@incident, @incident.response), method: :delete, class:"btn btn-secondary", type:"button" %>
              <% end %>
            </div>
          </div>
        </div>
        <%# /レスポンス投稿済みの場合 %>
      <% end %>
      <%# /レスポンス情報 %>

    </div>

    <%# コメント情報 %>
    <div class="row">
      <div class="col">
        <div class="card-body mx-2">
          <div class="card-text">

            <% if user_signed_in? %>
              <%= form_with model: [@incident, @comment], local: true do |f|%>
                <div class="field">
                  <%= f.label :content, "コメント" %><br />
                  <%= f.text_field :content, id:"comment_content" %>
                </div>
                <div class="actions">
                  <%= f.submit "送信する", class: :form__btn  %>
                </div>
              <% end %>
            <% end %>
            <ul class="comments_lists">
              <% @comments.each do |comment| %>
                <li class="comments_list">
                  <%= comment.content%>
                  <%= comment.user.name %>
                </li>
              <% end %>
            </ul>

          </div>
        </div>
      </div>
    </div>
    <%# /コメント情報 %>

  </div>
</div>